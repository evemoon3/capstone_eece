<!DOCTYPE html>
<html>
<head>
    {% load static %}
</head>
<body>

<h1>Server stuff</h1>
<p>{{ output }}</p>
<img id="pointCloudImage" src="{% static 'point_cloud_plot.png' %}?v={{ output }" alt="3D Point Cloud Plot" style="width: 400px; height: auto;"/>
<p> </p>

<button id="startButton">Start</button>
<p id="responseMessage"></p> <!-- To display any response -->

<button id="stopButton">Stop</button>
<p id="responseMessage2"></p> <!-- To display any response -->

<script>
let reloadInterval; // Variable to store interval ID

// Function to fetch the updated image URL from Django and update the image
function fetchNewImage() {
    fetch('/stuff/new-img/', { method: 'GET' })
        .then(response => response.json())
        .then(data => {
            let img = document.getElementById("pointCloudImage");
            let newSrc = img.src.split("?")[0] + "?v=" + new Date().getTime(); // Force fresh load

            // Preload new image before replacing old one (prevents flickering)
            let newImg = new Image();
            newImg.src = newSrc;
            newImg.onload = function() {
                img.src = newSrc; // Update image once fully loaded
            };
        })
        .catch(error => console.error('Error fetching new image:', error));
}

document.getElementById("startButton").addEventListener("click", function() {
    fetch('/stuff/start-button/', {  // URL of the Django view
        method: 'GET',
    })
    .then(response => response.json()) // Expect JSON response
    .then(data => {
        document.getElementById("responseMessage").innerText = data.message; // Show response

        // Start reloading the image every 3 seconds
        fetchNewImage(); // Call once immediately
        reloadInterval = setInterval(fetchNewImage, 3000);
    })
    .catch(error => console.error('Error:', error));
});
document.getElementById("stopButton").addEventListener("click", function() {
    fetch('/stuff/stop-button/', {  // URL of the Django view
        method: 'GET',
    })
    .then(response => response.json()) // Expect JSON response
    .then(data => {
        document.getElementById("responseMessage2").innerText = data.message; // Show response

        // Stop reloading the image
        clearInterval(reloadInterval);
    })
    .catch(error => console.error('Error:', error));
});
</script>
<img src="http://18.222.229.45:80/video_feed" width="848" height="480" />

<button id="startButton2">Start</button>
<p id="responseMessage3"></p> <!-- To display any response -->

<button id="stopButton2">Stop</button>
<p id="responseMessage4"></p> <!-- To display any response -->
<script>

document.getElementById("startButton").addEventListener("click", function() {
    fetch('/stuff/start-button/', {  // URL of the Django view
        method: 'GET',
    })
    .then(response => response.json()) // Expect JSON response
    .then(data => {
        document.getElementById("responseMessage").innerText = data.message; // Show response

        // Start reloading the image every 3 seconds
        fetchNewImage(); // Call once immediately
        reloadInterval = setInterval(fetchNewImage, 3000);
    })
    .catch(error => console.error('Error:', error));
});
document.getElementById("stopButton2").addEventListener("click", function() {
    fetch('/stuff/stop-button/', {  // URL of the Django view
        method: 'GET',
    })
    .then(response => response.json()) // Expect JSON response
    .then(data => {
        document.getElementById("responseMessage2").innerText = data.message; // Show response
    })
    .catch(error => console.error('Error:', error));
});
</body>
</html>